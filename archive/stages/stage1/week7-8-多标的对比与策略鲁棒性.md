# 阶段1 第7-8周理论学习笔记：多标的对比、策略鲁棒性与项目化

> 面向：数学基础≈初中、会一点 Python 的量化入门者。
> 目标：理解如何在多个时间区间和多个标的上检验策略、初步建立“鲁棒性”意识，并学会用项目化和文档化的方式组织自己的量化研究。

---

## 一、第7周：多标的、多区间的策略表现对比

### 1. 时间区间划分与样本描述

#### 1.1 数学思想
- 有一段完整历史数据（比如几年的 BTC 日线）。
- 不再把它当作“一整段”去分析，而是把时间轴切成多个区间：
  - 按年份切（2019、2020、2021...）；
  - 按市场阶段切（大涨期、大跌期、震荡期）；
  - 按波动水平切（高波动期、低波动期）。
- 对每个区间，单独统计：
  - 年化波动率；
  - 最大回撤；
  - 平均日收益率等。
- 本质上是在同一条时间序列上，增加一个“区间标签”字段，然后按区间分组统计特征。

#### 1.2 直观理解
- 就像看一个人的人生，不是只看“全人生平均状况”，而是分成：
  - 学生时代、工作初期、某个特殊年份……
  - 每个阶段的性格、收入、压力都不同。
- 市场也是这样：
  - 有些年份牛市疯狂上行；
  - 有些年份熊市连续下跌；
  - 有些阶段长时间横盘。
- 把历史分段，是为了避免“把牛市和熊市混在一起平均”，让你能看清“在不同环境下，市场特征和策略表现到底有什么差别”。

#### 1.3 对交易的意义
- **认识环境差异**：
  - 同一策略在牛市、熊市、震荡市的表现可能完全不同；
  - 如果只看整体平均，很容易被“稀释掉”的信息误导。
- **为后续策略测试打基础**：
  - 之后你会在每个区间单独跑回测；
  - 从而回答“这个策略到底适合什么样的环境”。

---

### 2. 不同时间区间上的双均线策略表现

#### 2.1 数学思想
- 固定一套策略参数（例如某组短期/长期均线）。
- 针对每个时间区间，单独运行同一套策略：
  - 计算区间内的总收益率、最大回撤、年化收益率等绩效指标；
  - 这些指标组成一个“按时间区间分组”的统计表。
- 这相当于：用相同的“实验条件”（参数），在不同“样本子集”（时间段）上重复做实验。

#### 2.2 直观理解
- 想象你在测试一种“学习方法”：
  - 在小学、初中、高中三个阶段分别试一遍；
  - 看看在哪个阶段效果最好、哪里踩坑最多。
- 对策略也是一样：
  - 在单边大涨行情的区间，双均线策略可能表现很好；
  - 在长时间震荡区间，可能频繁打止损、收益变差。

#### 2.3 对交易的意义
- 你能更具体地回答：
  - 这个策略在单边上涨期是不是特别强？
  - 在强烈下跌期是不是容易持续亏损？
  - 在震荡期是不是会频繁来回交易、成本很高？
- 这些结论会直接影响：
  - 你何时应该用这个策略，何时应该减仓甚至停用；
  - 你是否需要搭配其他策略对冲不同阶段的风险。

---

### 3. 多币种 + 多时间区间组合分析

#### 3.1 数学思想
- 在“时间区间”这一维度之外，再增加一维：标的（币种）。
- 对每个 **币种-时间段** 组合，记录一套绩效指标：
  - 行：不同币种 × 不同时间段；
  - 列：总收益率、最大回撤、年化收益、交易次数等。
- 形成一个“多维表格”或矩阵，可以做成热力图、分面子图等可视化。

#### 3.2 直观理解
- 可以把它想象成一张“考试班级成绩表”：
  - 行：班级（对应不同币种-时间段组合）；
  - 列：各科成绩（对应不同绩效指标）。
- 你一眼就能看到：
  - 哪些班级（币种-时间段组合）整体表现好；
  - 哪些明显拖后腿。

#### 3.3 对交易的意义
- **策略适用场景** 的初步轮廓：
  - 某些币种、某些时间段表现明显更好；
  - 某些组合收益和回撤都不理想。
- 为后续多策略、多标的配置提供信息：
  - 哪些标的是“策略天然朋友”；
  - 哪些标的可能需要更谨慎对待，或者干脆不碰这个策略。

---

### 4. 策略鲁棒性（稳健性）初步

#### 4.1 数学思想
- **鲁棒性（Robustness）** 大致意思是：
  - 在不同样本、不同环境、不同参数下，策略表现不会“从天堂掉到地狱”；
  - 可能不会在某一段时间达到“极致最优”，但在大多数环境下都还说得过去。
- 与之相对的是：
  - 只在某段历史、某个币种、某组非常精细调的参数下表现惊人；
  - 一旦换个时间段或标的，效果大幅变差，这就是典型的“过拟合”迹象。

#### 4.2 直观理解
- 想象两种学习方法：
  - 方法 A：你用在任何学科、任何老师的课上，都能保持中上水平；
  - 方法 B：只在某一位老师的课上、某一夹讲义上，效果逆天，一换老师就完全不行。
- 很明显，长期来看你更愿意选择方法 A —— 这就是“稳健性”的直觉。

#### 4.3 对交易的意义
- 量化里，**不要被某一段漂亮的历史曲线骗了**：
  - 你更需要的是一套在多数环境里都不过分难看、能接受的表现；
  - 而不是在单段历史里“神一样”的曲线。
- 第7周希望你做的，是用多币种、多时间段的结果，
  - 给自己一个“鲁棒性”的工作定义：
  - 比如：
    - 大多数币种-时间段组合都盈利或平稳；
    - 极少出现“某几个组合暴亏、回撤巨大”的情况。

---

### 5. 结果可视化与展示整理

#### 5.1 数学思想
- 本质上是把多维表格（币种 × 时间段 × 指标）通过图形方式呈现：
  - 热力图：颜色表示收益或夏普，横轴纵轴分别是币种和时间段；
  - 分面子图：每个子图对应一个币种，内部再画不同时间段表现。
- 没有新数学，只是换一种更易读的表示方式。

#### 5.2 直观理解
- “让不看代码的人，也能看懂结果”：
  - 对老板、合伙人、甚至未来的自己，都非常重要。

#### 5.3 对交易的意义
- 清晰的图表和说明：
  - 能帮助你快速比较策略优劣；
  - 也能逼你自己把逻辑说清楚，避免“凭感觉”。
- 这是走向“量化研究者”而不是“写几行代码赌运气”的关键一步。

---

## 二、第8周：阶段1综合项目与文档化

### 1. 综合项目规划：先问清“我要研究什么”

#### 1.1 数学思想
- 把前面零散的练习整合成一个“研究项目”：
  - 先确定 **研究问题**（例：BTC 双均线策略在不同周期和成本假设下表现如何？）；
  - 明确 **数据范围**（时间段、频率、币种）；
  - 列出要输出的 **指标**（收益、回撤、波动）和 **图表**（资金曲线、回撤曲线、多标的对比等）。
- 本质上是：
  - 先定义“输入是什么、处理流程是什么、输出要看到什么”。

#### 1.2 直观理解
- 就像做一个小论文或一个公司内部的研究报告：
  - 不能从写代码开始，而是从“研究问题”和“预期结果形式”开始。

#### 1.3 对交易的意义
- 有清晰的问题，才不会在历史数据里“乱翻”：
  - 减少随意调参、事后找理由；
  - 更容易判断一个策略是否值得继续深入。

---

### 2. 代码重构：数据处理与特征工程模块

#### 2.1 数学思想
- 将重复出现的操作抽象成函数：
  - 数据读取（CSV / API）；
  - 收益率计算、滚动波动率、均线、布林带、RSI等特征计算。
- 每个函数都可以看成是“输入一个 DataFrame，输出一个加工后的 DataFrame 或新增列”的映射。

#### 2.2 直观理解
- 把零散的代码片段收进“工具箱”：
  - 需要时一行调用，而不是到处复制粘贴。
- 给函数加上 **文档字符串**（docstring）：
  - 说明输入是什么，输出是什么，用来干嘛；
  - 等于给将来的自己写“中文说明书”。

#### 2.3 对交易的意义
- 数据处理和特征工程是所有策略的地基：
  - 地基做得扎实、可复用，以后搭建任何策略都会更快、更稳。
- 减少“隐形 bug”：
  - 有统一的数据处理函数，更容易检查哪里出了问题。

---

### 3. 代码重构：策略与回测模块

#### 3.1 数学思想
- 把策略逻辑和回测过程拆分成清晰的函数：
  - 策略信号函数：输入特征表，输出 `signal` 列（如 1 表示做多，0 空仓，-1 做空）；
  - 回测执行函数：输入 `signal` 和收益率，输出资金曲线和绩效指标，可设置手续费参数。
- 这样一来：
  - 同一个回测模块，可以对接不同的策略信号；
  - 同一个策略信号，也可以在不同币种、时间段上复用。

#### 3.2 直观理解
- 把整个流程拆成几块“流水线”：
  - 原始数据 → 特征工程 → 策略信号 → 回测 → 绩效输出；
  - 每一块都是可以单独更换、升级的模块。

#### 3.3 对交易的意义
- 为未来的“多策略 + 回测框架”打基础：
  - 你可以更容易地：
    - 换周期；
    - 换标的；
    - 换策略；
    - 换手续费假设；
  - 而不用重写一大堆重复代码。

---

### 4. 统一绩效评估与图表输出

#### 4.1 数学思想
- 和前面一样，把绩效计算和绘图封装成函数：
  - 绩效函数：输入资金曲线或收益率，输出年化收益、最大回撤、夏普等；
  - 绘图函数：输入资金曲线，画出资金曲线图、回撤曲线等。

#### 4.2 直观理解
- 你有了一套“标准评分表”和“标准图表模板”：
  - 不管哪个策略，都用同一种方法打分、画图；
  - 结果更容易横向对比。

#### 4.3 对交易的意义
- 统一标准能避免“想怎么说就怎么说”：
  - 不会因为换了评价方法而让某个策略看起来特别好；
  - 更容易比较不同策略在同一套标准下的优劣。

---

### 5. 项目整合与一键复现

#### 5.1 数学思想
- 从“很多 Notebook + 脚本”走向“结构清晰的项目”：
  - 有明确的目录结构；
  - 有主入口（一个 Notebook 或脚本）可以一键跑完整流程；
  - 各模块之间依赖关系清晰。

#### 5.2 直观理解
- 就像整理一台电脑：
  - 不再把所有文件乱丢在桌面；
  - 而是分类放好，起清晰的名字，并确认从头到尾可以顺利跑通。

#### 5.3 对交易的意义
- **可复现性**：
  - 过一段时间你回来，或者别人拿到你的项目，只要照着说明，一键运行即可得到相同结果；
  - 这是严肃量化研究的基本门槛。

---

### 6. 综合项目报告结构与写作思路

#### 6.1 数学思想
- 报告结构本身没新的数学，但要求你重新梳理：
  - 数据来源、处理方法（属于“方法”部分）；
  - 策略逻辑（属于“模型假设”部分）；
  - 回测结果和性能指标（属于“结果”部分）；
  - 优缺点、适用场景和改进方向（属于“讨论与结论”部分）。

#### 6.2 直观理解
- 把你这几周做的事情，
  - 从“代码和图”转化为“别人能看懂的故事”：
    1. 我想研究什么问题；
    2. 我是怎么做的；
    3. 得到了什么结果；
    4. 如何理解这些结果；
    5. 下一步打算干什么。

#### 6.3 对交易的意义
- 写报告的过程，会逼你：
  - 正视策略的缺点和风险来源；
  - 不再只看资金曲线，而是思考“这个策略到底为什么有用，它的逻辑是什么”；
  - 为未来与别人沟通、合作（比如向团队展示策略）打基础。

---

## 三、第7-8周整体小结：从“跑一次回测”到“做一个可以复现的研究”

1. **第7周** 的核心，是在多时间区间、多币种上观察策略表现：
   - 用“区间划分 + 样本描述”理解不同市场环境；
   - 用多标的、多时间段的结果来初步判断策略鲁棒性；
   - 学会用表格、热力图等方式清晰呈现结果。

2. **第8周** 的核心，是把零散的代码和练习，整理成一个完整的项目：
   - 项目化：有明确的研究问题、数据范围和输出形式；
   - 模块化：数据、特征、策略、回测、评估和绘图各自独立又能协同；
   - 文档化与可复现：任何时候都能“一键重现你的研究结果”。

> 阶段1 的最后两周，不再强调“学多少新公式”，而是让你像一个真正的量化研究者那样：
> 在多个环境下检验策略是否稳健，用规范的代码和文档组织自己的研究。
> 这样进入阶段2 时，你就不仅是“会写一点策略代码”，而是已经具备了做系统化量化项目的基本能力。
