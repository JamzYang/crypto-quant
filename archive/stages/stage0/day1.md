# 环境搭建

---

## 整体设计思路（“为路线图服务”的依赖）

这些依赖的思路是：

- **先学“数据 + 可视化”** → 养成用代码观察行情、验证想法的习惯  
- **再学“交易所 API + 技术指标”** → 能拉真实数据、写简单策略  
- **然后到“回测框架”** → 能系统地评估策略  
- **最后扩展到“机器学习/因子模型”等进阶内容**

[requirements.txt](cci:7://file:///c:/develop/learnspace/crypto-quant/requirements.txt:0:0-0:0) 中启用的是**必备基础 + 交易所 + 技术指标**，  
而回测、数据源扩展、机器学习这些是**后期才会用到的，先写成注释**，对应路线图的后续阶段。

---

## 核心数据处理

- **`numpy>=1.24.0`**
  - **用途**：高性能数值计算，向量化运算（如价格数组、收益率数组、移动窗口等）
  - **为什么要用**：
    - 几乎所有量化/科学计算库的底层都依赖 `numpy`
    - 用 `numpy` 处理数据，速度比纯 Python 的 `for` 循环快一个数量级
  - **在学习路线中的位置**：  
    - 初级阶段：理解`ndarray`、向量化、广播等，为因子计算、指标计算打基础

- **`pandas>=2.0.0`**
  - **用途**：表格数据和时间序列数据处理（K线、逐笔成交、因子表等）
  - **为什么要用**：
    - 量化里几乎所有数据都可以抽象成 `DataFrame`（日期 × 字段）
    - 对齐、重采样、滚动窗口、缺失值处理、分组统计等操作非常方便
  - **在学习路线中的位置**：  
    - 初级阶段：学会用 `DataFrame` 管理行情数据  
    - 中级阶段：构建因子、聚合多品种数据、对齐多源数据

---

## 数据可视化

- **`matplotlib>=3.7.0`**
  - **用途**：底层绘图库，折线图、K线图、回测净值曲线等
  - **为什么要用**：
    - 是 Python 可视化的“基石”，很多高级库都基于它
    - 可以高度自定义图形（子图、坐标轴、标注等）
  - **在学习路线中的位置**：  
    - 早期就需要：画价格走势、盈亏曲线、指标线

- **`seaborn>=0.12.0`**
  - **用途**：基于 `matplotlib` 的高级可视化库，适合做统计图、分布图、相关性热力图
  - **为什么要用**：
    - 更容易做出“好看且信息量大”的图（分布、箱线图、pairplot 等）
    - 辅助你做策略效果分析，比如收益分布、回撤分布、因子与收益的关系
  - **在学习路线中的位置**：  
    - 在“策略评估/统计分析”章节会频繁用到，用图来理解策略特性

---

## 交互式开发环境

- **`jupyter>=1.0.0`**
  - **用途**：Notebook 环境，把代码、文字说明、图表放在一起
  - **为什么要用**：
    - 非常适合“研究型”工作：一边试代码，一边记录思路和结论
    - 对于学习路线图里的每一小节，都可以用一个 Notebook 实战练习
  - **在学习路线中的位置**：  
    - 贯穿始终：从数据探索、策略原型，到结果展示，全部可以在 Notebook 里完成

- **`ipython>=8.0.0`**
  - **用途**：增强版 Python 交互解释器，支持自动补全、魔法命令等
  - **为什么要用**：
    - 在 Notebook 内核、终端实验时都很方便
    - 例如 `%timeit` 测试代码运行时间、`%matplotlib inline` 控制图像显示等
  - **在学习路线中的位置**：  
    - 辅助工具，贯穿全程，提高交互体验和调试效率

---

## 交易所 API

- **`ccxt>=4.0.0`**
  - **用途**：统一封装了上百家交易所的 REST/WebSocket API
  - **为什么要用**：
    - 一套代码可以对接多个交易所（Binance、OKX 等），减少重复学习各家 API
    - 可以获取行情、下单、查询账户余额等，是“真正连接到交易所”的关键组件
  - **在学习路线中的位置**：  
    - 在路线图中“实盘接口/交易所 API”阶段使用  
    - 可用于拉历史 K 线做回测，也可用于简单实盘测试（注意风控）

---

## 技术指标库

- **`ta-lib>=0.4.0`**（需要先安装 TA-Lib C 库）
  - **用途**：C 实现的技术指标库，包含 MA、MACD、RSI、布林带等各种常见指标
  - **为什么要用**：
    - 性能好、指标多，调用方式简单：`talib.SMA`, `talib.RSI` 等
    - 避免你一开始就自己写各种滑动窗口逻辑，先能跑出策略再说
  - **在学习路线中的位置**：  
    - “技术分析/策略构建”阶段的主力工具  
    - 先用现成指标快速实现规则，再逐步过渡到自定义因子/信号
  - **备注**：
    - 安装前需要系统层面先装 TA-Lib C 库，说明里已经备注了这一点

---

## 回测框架（后续阶段，暂时注释）

- **`backtrader` / `vectorbt`**（目前在 [requirements.txt](cci:7://file:///c:/develop/learnspace/crypto-quant/requirements.txt:0:0-0:0) 中是注释）
  - **用途**：
    - `backtrader`：经典回测框架，事件驱动风格，适合学习和中小策略
    - `vectorbt`：基于 `numpy/pandas` 的向量化回测/因子分析框架，速度快，和 Notebook 配合好
  - **为什么先注释**：
    - 路线图是“由浅入深”，一开始先学数据处理、简单策略逻辑和可视化
    - 回测框架本身学习成本不低，等你熟悉基础后再启用，更容易消化
  - **在学习路线中的位置**：  
    - 属于中后期“系统化回测与评估”的阶段  
    - 对应路线图里“搭建回测框架、评估策略表现”的章节

---

## 数据获取（可选，暂时注释）

- **`yfinance`**
  - **用途**：从 Yahoo Finance 获取股票/指数/基金等历史数据
  - **意义**：
    - 如果你做多市场（不仅是币圈），这是获取免费历史数据的便捷方式
    - 也可以在没接交易所 API 时，用它来练手策略逻辑

- **`python-binance`**
  - **用途**：Binance 官方/半官方风格的 API SDK
  - **意义**：
    - 当你想更深入使用某一家交易所（这里是币安）的全部功能时，会比 `ccxt` 更细致
  - **为什么暂时注释**：
    - 初期先用 `ccxt` 统一接口思路，等对 Binance 有特别需求时再启用

---

## 机器学习（后续进阶，暂时注释）

- **`scikit-learn`**
  - **用途**：传统机器学习库（回归、分类、聚类、降维、模型评估等）
  - **在量化中的典型用法**：
    - 预测收益/波动、聚类股票、构建打分模型、风险模型等

- **`xgboost`**
  - **用途**：性能强、效果好的梯度提升树库
  - **在量化中的典型用法**：
    - 做“因子模型 + 分类/回归”，比如预测次日上涨概率、收益排序等
  - **为什么暂时注释**：
    - 这是路线图后半段“机器学习/智能选股/因子模型”的内容  
    - 目前优先打好统计和规则策略基础，防止还没理解“规则型策略”就直接上黑箱模型

---

## 小结：和学习路线图的对应关系

结合你的 `docs/roadmap/学习路线图.md` 可以大致对应为：

- **第一阶段：基础数据与可视化**
  - 用 `numpy + pandas + matplotlib + seaborn + jupyter/ipython`
- **第二阶段：接入真实市场**
  - 用 `ccxt` 拉取真实交易所数据，做简单策略和信号
- **第三阶段：技术指标 & 回测**
  - 用 `ta-lib` 做指标信号  
  - 逐步启用 `backtrader` / `vectorbt` 做系统化回测
- **第四阶段：扩展数据源 & 机器学习**
  - 需要时打开 `yfinance` / `python-binance`  
  - 进阶时启用 `scikit-learn` / `xgboost` 做机器学习策略

---



# 实验解释


你问的是：解释一下 `实验2：交易收益的期望和方差` 的数学思想。

下面结合这段代码来讲数学直觉，而不是讲 Python 细节。

---

## 1. 这段实验在干什么？

[returns_statistics()](cci:1://file:///c:/develop/learnspace/crypto-quant/src/stage0/%E9%98%B6%E6%AE%B50-%E6%95%B0%E5%AD%A6%E9%A2%84%E7%83%AD%E4%BB%A3%E7%A0%81%E7%A4%BA%E4%BE%8B.py:37:0-82:15) 里核心几行：

```python
np.random.seed(42)
returns = np.random.normal(loc=0.5, scale=2.0, size=100)

mean_return = np.mean(returns)
std_return = np.std(returns)
median_return = np.median(returns)
```

抽象成一句话：

> 用正态分布随机“生成”100 次交易收益，然后用这 100 个样本来估计这条策略的“收益水平”和“风险大小”。

---

## 2. 期望（均值）：长期平均收益

- `loc=0.5` 表示：单次收益服从均值为 `0.5%` 的正态分布。
- `mean_return = np.mean(returns)` 就是在用 100 次的平均值去估计这个“真实均值”。

**数学思想：**

- 随机变量 `R` 的数学期望 `E[R]` = 理论上的平均收益。
- 实际交易中拿不到“真值”，只能拿很多次样本 `R₁, R₂, …, Rₙ`，计算：
  
  \[
  \bar{R} = \frac{1}{n} \sum_{i=1}^n R_i
  \]

- 当 `n` 足够大时，\(\bar{R}\) 会接近 \(E[R]\) —— 这是**大数定律**在这里的应用。

**直观理解：**

- `平均收益 ≈ 这条策略长期玩下去，每次大概能赚多少 %`。
- 如果你有多条策略，就可以比较谁的平均收益更高。

---

## 3. 方差 / 标准差：收益波动大小 = 风险

```python
std_return = np.std(returns)
```

- `scale=2.0` 表示收益的标准差理论上是 `2%`。
- `np.std(returns)` 是用样本去估计真实的标准差。

**数学思想：**

- 标准差（或者方差）刻画的是“偏离均值”的程度。
- 随机变量 `R` 的方差：

  \[
  \mathrm{Var}(R) = E[(R - E[R])^2]
  \]

- 标准差是方差开根号，是“波动幅度”的单位度量。
- 在交易里：**波动越大 = 收益不稳定 = 风险越大**。

**直观理解：**

- 即使两条策略平均收益都在 1%，  
  一个标准差是 1%，一个是 10%，感受完全不同：
  - 标准差 1%：每天收益很“稳”，大概就在 1% 附近晃。
  - 标准差 10%：有时 +20%，有时 -15%，坐过山车。

---

## 4. 中位数：抗极端值的“典型收益”

```python
median_return = np.median(returns)
```

**为什么要看中位数？**

- 平均数会被极大值/极小值拖拽。
- 中位数更像是“典型的一次收益”。
- 在收益分布偏斜、有极端值时：  
  **中位数给出的“典型表现” > 均值给出的“理论表现”。**

---

## 5. 分布直方图 + 累计收益曲线的意义

### 5.1 直方图

```python
plt.hist(returns, bins=20, ...)
plt.axvline(mean_return, ...)
plt.axvline(median_return, ...)
```

**数学思想：**

- 把一堆样本画成频数直方图，是在“估计概率分布”。
- 如果真实分布是正态的，样本直方图会越来越像钟形曲线。
- 直方图让你看到：
  - 大部分收益落在哪个区间。
  - 亏损区域有多宽、多深。
  - 极端大亏/大赚出现的频率。

### 5.2 累计收益曲线

```python
cumulative_returns = np.cumsum(returns)
plt.plot(cumulative_returns)
```

这里简单用“逐次相加”模拟累计收益（实际更严谨的做法是用复利 `cumprod`）。

**数学思想：**

- 把每次交易的收益加起来，可以看出：
  - 短期可能波动很大；
  - 长期走势是上升、横盘还是下跌。
- 形象展示了：**同一个“分布特征”延伸到时间维度后的效果**。

---

## 6. 这整个实验想让你建立哪几个核心直觉？

- **直觉1：收益是随机变量，不是固定数字。**
  - 每一次收益都是从某个分布里“抽样”。

- **直觉2：期望 = 这条策略长期能赚多少钱（平均水平）。**

- **直觉3：方差/标准差 = 这条策略收益有多不稳定（风险）。**

- **直觉4：同样均值不同方差的策略，体验完全不同。**
  - 做策略不只看“赚多少”，还要看“波动多大”。

- **直觉5：图像化 > 公式。**
  - 分布图 + 累计收益图，比公式更能让你记住这些概念。

---

### 用交易直觉解释方差和标准差：
假设某策略日收益：
 - 平均收益：1%
 - 标准差：2%
直觉可以说：
 - “大部分时候，一天的涨跌在 -3% ~ +5% 左右晃（大概是 1% ± 2% 的量级）”
如果只给你一个“方差 = 4”（单位 %^2），其实你脑子还要再开根号才有感觉；
所以实战中大家基本都说标准差，而不是说方差。

---

## 7. 实验3：相关性 - BTC 与 ETH 的关系

这个实验对应代码里的 `correlation_example()`。

### 7.1 这段实验在干什么？

可以先把代码干的事情压缩成一句话：

> 随机“生成”一段 BTC 和 ETH 的日收益，然后看看它们是不是**经常同涨同跌**，再用一个数字来刻画这种“一起动”的程度。

直觉上：

- 如果 BTC 涨的时候，ETH **也经常涨**，BTC 跌的时候，ETH **也经常跌**，那就是“相关性很强”。
- 如果 BTC 涨跌，ETH 完全随缘，有时一起涨，有时反着走，那就是“相关性很弱”。

### 7.2 散点图 + 相关系数的直觉

代码里画了一张散点图：

- 横轴：BTC 日收益率
- 纵轴：ETH 日收益率

你可以这样记：

- 点云主要集中在“右上角 + 左下角”（一起涨、一起跌） → **正相关**。
- 点云主要集中在“右下角 + 左上角”（一个涨、一个跌） → **负相关**。
- 点云到处乱飞，看不出明显斜线 → **相关性很弱**。

代码还会算一个相关系数 `correlation`：

- 取值范围在 `-1` ~ `1`。
  - 接近 `1`：强正相关，基本同涨同跌。
  - 接近 `0`：几乎各走各的。
  - 接近 `-1`：强负相关，一个涨时另一个往往跌。

你可以先把“相关系数”当成一个

> 告诉你“两种资产是不是一条船上”的数字。

### 7.3 对投资的意义（0 基础版）

从“炒币”的角度看：

- 如果你买的都是高度正相关的币（比如一堆大盘币）：
  - 大涨的时候大家一起爽；
  - 大跌的时候大家一起跪；
  - **表面上分散了很多标的，实际上整体风险没被真正摊薄。**

- 如果你能搭出一个“相关性没那么高”的组合：
  - 某些币跌的时候，另外一些不一定跟着跌，甚至可能涨；
  - 组合整体的净值曲线会更平滑，不那么像过山车。

这一节想让你建立的直觉是：

- **相关性 ≈ “两个资产会不会一起涨跌”的程度。**
- 做组合投资，不光要看“每个资产自己赚多少 / 波动多大”，还要看**它们彼此之间是不是绑在一条船上**。

---

## 8. 实验4：风险与收益权衡

这个实验对应代码里的 `risk_return_tradeoff()`。

### 8.1 这段实验在干什么？

代码里设计了三种策略：

- 稳健策略：收益不算最高，但波动更小。
- 激进策略：收益更高，但波动也更大。
- 极端策略：平均收益看起来很高，但波动巨大，有可能“玩着玩着就玩没了”。

然后用模拟的方式，让这三条策略各自“跑完一年”，画出三条**累计收益曲线**，看看：

- 哪条线走得快？（收益高不高）
- 哪条线抖得厉害？（风险大不大）

### 8.2 为啥不能只看“赚多少钱”？

学了期望以后，一个很自然的想法是：

> “那我就选平均收益最高的策略不就完了？”

这个实验就是专门来反例你的：

- 极端策略：给你设定一个很高的平均收益，但同时给一个超大的波动（标准差）。
- 结果可能是：
  - 前面一段时间涨得特别爽；
  - 接着几次连续大亏，把之前赚的全吐回去甚至更惨；
  - 一年跑完，**最终收益反而不如稳健策略**，甚至是负的。

直觉画面：

- 一条线平均往上爬得更快，但上下剧烈震荡，看得人心惊肉跳 → 很难长期拿得住。
- 另一条线爬得慢一点，但更平滑 → 心理上更容易坚持三年五年。

所以，这个实验想告诉你：

- **高收益 ≠ 好策略。**
- 真正重要的是“**收益 + 风险一起看**”。

### 8.3 夏普比率的直觉（简化版）

代码里有一句：

```python
'sharpe': params['mean'] / params['std']  # 夏普比率简化版
```

这里写的是一个“非常简化版”的夏普比率，表达的意思是：

> 每承担 1 份风险，你能换来多少份收益？

用一个非常粗糙的例子：

- 甲策略：平均收益 10%，标准差 5% → “每单位风险换来 2 份收益”。
- 乙策略：平均收益 15%，标准差 15% → “每单位风险只换来 1 份收益”。

虽然 15% > 10%，但从“性价比”的角度看：

- 甲策略：用较小的波动换来不错的收益，**更划算**；
- 乙策略：看起来更猛，但你为每一份波动付出的代价更大，**风险回报比反而不高**。

这就是夏普比率想表达的核心：

- 不要只问“这条策略一年能赚多少？”，
- 还要问“**为了这些收益，我承担了多大的波动？值不值？**”。

### 8.4 给 0 基础读者的三个记忆点

- **记忆点 1：高收益不一定好。**
  - 如果波动巨大让你中途爆仓 / 心态崩溃，再高的历史收益都是别人的。

- **记忆点 2：风险是可以被“量化”的。**
  - 可以用“标准差”看波动大小，用“夏普比率”看风险回报比。

- **记忆点 3：最好的策略是你能拿得住的策略。**
  - 一条看起来很猛但你拿不住的曲线，不如一条你能安心拿三年的稳健曲线。