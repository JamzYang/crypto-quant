## Day 8：统计量深入——均值、中位数、分位数与极值

> 今天的目标：
> - 理解“**平均数**”不止一种：均值 vs 中位数
> - 知道什么是 **分位数（25%、50%、75%）**
> - 明白 **极值** 为什么会“污染”你的统计分析

---

### 一、数学思想：为什么要学这些统计量？

- **均值 / 中位数 / 分位数**，本质上都在回答一个问题：
  - “这堆数据，**整体水平大概在哪？** 分布大概是什么形状？”
- 在金融场景里，你常见的问题是：
  - 某个策略的收益“**通常**”是多少？
  - 偶尔会亏多少？极端行情下会发生什么？
- 单纯看一个“平均数”，往往会被少数极端值欺骗。
  - 所以我们需要：
    - **均值**：加权平均，反映整体“数学期望”
    - **中位数**：排序后中间那个数，更代表“典型水平”
    - **分位数**：进一步刻画“上下分布”，比如 25%、50%、75%

先记住一句话：

> **均值侧重“数学期望”，中位数和分位数侧重“典型情况和分布形状”**。

---

### 二、均值 vs 中位数：谁更“稳健”？

#### 1. 概念回顾

- **均值（mean）**：
  - 把所有数加起来，再除以数量。
  - 对数学来说很好用（线性、可微、方便推导）。
  - 但对极端值 **非常敏感**。

- **中位数（median）**：
  - 把数据从小到大排序，取正中间那个数。
  - 如果是偶数个数，一般取中间两个数的平均。
  - 只关心“排位”，不关心具体数值大小变化，因此对极端值 **不敏感**。

在统计学里，有一个重要概念：

> **稳健性（robustness）**：
> 当数据里出现极端值/异常值时，这个统计量是否还能保持“代表性”？

均值很“脆弱”，中位数相对“稳健”。

#### 2. 直观理解：工资例子

假设某小公司有 6 个人，月薪如下（单位：k）：

```text
数据：1, 2, 3, 4, 5, 100
```

- **均值**：
  - (1 + 2 + 3 + 4 + 5 + 100) / 6 = 115 / 6 ≈ 19.17
  - 你会得到一句话：“这家公司 **平均工资** 约 19k”。
  - 但实际上，只有一个人拿 100k，其余都是 1–5k，这个“平均数”**严重失真**。

- **中位数**：
  - 排序后依然是：1, 2, 3, 4, 5, 100
  - 中间两个数是 3 和 4，中位数 = (3 + 4) / 2 = 3.5
  - “这家公司典型员工的工资大概 3.5k”，这个就 **更接近大多数人的真实情况**。

所以：

- 当你要描述“**大多数人的典型水平**”时，
  - 用 **中位数** 会比只用均值更稳健。
- 当你做理论推导、计算期望收益等，
  - 均值依然非常重要，因为它和概率论、期望的数学结构深度绑定。

> 在金融和量化里，经常要 **同时看均值和中位数**，而不是只盯一个数字。

---

### 三、分位数：25%、50%、75% 在说什么？

#### 1. 数学思想

分位数（quantile）是在回答：

> “有多少比例的数据落在某个值以下？”

常见的几个：

- **50% 分位数**：正好一半数据在它以下，一半在以上，这就是 **中位数**。
- **25% 分位数（第一四分位数，Q1）**：
  - 25% 的数据在它以下，75% 在它以上。
- **75% 分位数（第三四分位数，Q3）**：
  - 75% 的数据在它以下，25% 在它以上。

这三个点（Q1、Q2、Q3）把数据大致切成四份：

```text
   25%        50%        75%
   Q1         Q2         Q3
 |----|-------|---------|
```

它们一起描述了：

- 数据的“中间一块”大概在哪个区间
- 数据是偏左（低）还是偏右（高）
- 中间这 50% 数据（Q1 到 Q3）是否很集中还是很分散

#### 2. 直观理解：还是用刚才那组数据

还是那组：

```text
1, 2, 3, 4, 5, 100
```

粗略直觉（不用纠结插值细节）：

- 25% 分位数（Q1） ≈ 2
- 50% 分位数（Q2，中位数） = 3.5
- 75% 分位数（Q3） ≈ 5

你可以这样解读：

- 25% 的人薪水低于约 2k
- 50% 的人在 3.5k 以下
- 75% 的人在 5k 以下

真正“极端”的 100k，只影响了最右边那一小部分数据。

> 分位数在“看到整体分布”这件事上，比单个均值/中位数更有信息量。

在金融中：

- 你可能会关心“**最差 5% 的结果大概有多惨**”
  - 这就是常说的 **5% 分位数**，在风险管理里和 VaR（在险价值）有紧密关系。

---

### 四、极值（异常值）的影响

极值（outlier）指的是：

- 明显偏离大部分数据的值，比如：
  - 大多数收益率在 -2% ~ +2%，
  - 偶尔来一个 +30% 或 -40%。

#### 1. 对不同统计量的影响

- **均值**：
  - 对极值非常敏感。
  - 一个极端大亏/大赚，可能把总体均值直接拉正或拉负。

- **中位数和分位数**：
  - 只看排序位置，不直接看数值大小。
  - 只要极值数量不多，它们对中位数/大部分分位数的影响很有限。

仍然用工资数据做类比：

- 把 100 换成 1000，均值会进一步被拉高；
- 但中位数和 25%/75% 分位数几乎不变，因为“排序结构”基本没变。

#### 2. 在金融里的含义

金融数据天然有“肥尾”：

- 平时波动不大，偶尔出现极端行情（闪崩、暴涨）。

如果你只看均值：

- 可能觉得“平均每天赚 0.5%”，很美好；
- 但极端几天的大亏，可能让你彻底爆仓。

因此：

- 做策略评估时：
  - 看 **均值**：长期期望收益
  - 看 **分位数**：坏情况时大概会亏到什么程度
  - 看 **极值**、**最大回撤** 等：最糟糕的路径有多吓人

---

### 五、和 Day 8 代码示例的连接

计划里给了这样一段代码（示意）：

```python
# 数据包含异常值
data = [1, 2, 3, 4, 5, 100]

print(f"均值: {np.mean(data)}")
print(f"中位数: {np.median(data)}")
print(f"25%分位数: {np.percentile(data, 25)}")
print(f"75%分位数: {np.percentile(data, 75)}")
```

建议你在练习时，按下面步骤思考：

- **步骤1：打印结果 + 手算对比**
  - 自己算一遍均值、中位数，和代码结果对比，确保“数字层面”没问题。

- **步骤2：想象没有 100 这个极值**
  - 把数据改成 `[1, 2, 3, 4, 5, 6]`，再跑一遍：
    - 均值会怎么变化？
    - 中位数怎么变化？
    - 25%、75% 分位数怎么变化？
  - 比较“有极值”和“无极值”的两组结果。

- **步骤3：总结一句话**
  - 极值主要“拽动”了哪些统计量？
  - 哪些统计量相对比较稳？

如果你能用自己的话回答这些问题，说明 Day 8 的核心就吃透了。

---

### 六、和实战练习（BTC 日收益率）的关系

在 Day 8 的练习中，你会：

- 获取 BTC 的日收益率序列（后面阶段会有获取数据的代码）
- 计算：
  - 均值（平均日收益）
  - 中位数
  - 若干分位数：5%、25%、50%、75%、95% 等

你可以这样解读这些数字：

- **均值**：
  - 长期平均下来，一天大概赚/亏多少？

- **中位数（50% 分位数）**：
  - “一半的日子里，收益低于这个值，一半高于这个值”。
  - 如果中位数明显低于均值，说明极端暴涨日子把均值拉高了。

- **5%/95% 分位数**：
  - 5% 分位数：最差那 5% 的日子，大概亏到什么程度？
  - 95% 分位数：最好那 5% 的日子，大概赚到什么程度？

> 以后你做风控、算 VaR、看回撤，本质上都离不开“极值 + 分位数”的思路。

---

### 七、今日小结

- **均值（mean）**：
  - 优点：数学上好用，和期望值直接相关。
  - 缺点：对极值非常敏感，容易被少数极端值“骗”。

- **中位数（median）**：
  - 优点：更能代表“典型情况”，对极值更稳健。
  - 缺点：在复杂数学推导里不如均值好用。

- **分位数（quantile）**：
  - 描述“有多少比例的数据落在某个值以下”。
  - Q1（25%）、Q2（50%，中位数）、Q3（75%）一起刻画整体分布形状。

- **极值的影响**：
  - 严重影响均值，略微影响分位数，几乎不动大多数数据的排位。
  - 在金融中，极值往往对应极端行情，是风险管理的重点关注对象。

如果要用一句话记住今天的核心：

> **看均值是为了理解“长期期望”，看中位数和分位数是为了理解“日常表现和极端风险”**。

这就是 Day 8 的数学思想和直观理解。明天你会继续在相关性、可视化等内容中，用这些统计量看更多真实数据。