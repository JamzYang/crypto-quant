# Week1 概率分布 + pandas 理论学习笔记

> 面向对象：Java 后端背景、数学基础偏弱的工程师。
>
> 学习目标：用“工程师视角”理解第 1 周的数学和 pandas 理论，不追求推公式，只追求：**我到底在算什么，这对交易有啥用？**

---

## 1. 本周理论大图

### 1.1 数学方向在讲什么？

- **正态分布（Normal Distribution）**
  - 许多“很多小因素叠加”的随机现象，结果会集中在一个平均值附近，两边对称，形成“钟形曲线”。
  - 在金融里，很多早期/简单模型会假设“收益率服从正态分布”。

- **偏度（Skewness）、峰度（Kurtosis）、肥尾分布（Heavy Tail）**
  - 偏度：分布是否“向左/向右歪”。
  - 峰度：分布中“尖不尖、尾巴肥不肥、极端值多不多”。
  - 肥尾分布：比正态分布更容易出现极端涨跌。

- **大数定律 & 中心极限定理**
  - 大数定律：重复实验次数多了之后，“平均值”会越来越稳定。
  - 中心极限定理：很多独立随机变量的和/平均值，会趋向于正态分布。

### 1.2 工程工具方向在讲什么？

- 用 **pandas** 处理金融时间序列：
  - `DataFrame` / `Series` 理解成“带时间索引的表格”和“单列数据”。
  - `loc` / `iloc`、时间索引、缺失值处理。
  - **重采样（resample）**：把日线数据聚合成周线/月线，关注不同时间尺度。
  - **滚动窗口（rolling）**：观察“最近 N 天”的均值、波动率等特征。

### 1.3 本周理论与实践的连接

- 理论部分回答：
  - 收益率到底在“分布”什么？
  - 为什么要看“偏度、峰度、肥尾”？
  - 为什么“多次试验平均值更稳定”？
- 实践部分让你：
  - 用 BTC 日线数据计算收益率。
  - 画直方图，看收益率大致长什么样。
  - 用 pandas 做重采样、滚动窗口，为后面策略和波动率分析做准备。

---

## 2. 正态分布与收益率

### 2.1 数学思想（工程师版）

- 想象很多**小的随机影响**叠加在一起：
  - 每天有各种利好/利空、资金流入流出、市场情绪波动。
  - 每个影响都不大，但**总和**就是当天的收益率。
- 当这些小影响“差不多独立、大小差不多”时，它们的和会慢慢接近一种标准的形状——**正态分布**。
- 正态分布的几个核心特征：
  - **均值（μ）**：分布中心，长期平均水平。
  - **标准差（σ）**：分布的“宽度”，代表波动大小。
  - 关于均值左右对称，两边尾巴很长但质量很小。

### 2.2 直观理解

- 图形上像一座对称的“钟形山”：
  - 中间最高，说明**大部分结果集中在平均值附近**。
  - 离均值越远，概率越小，曲线越低。
- 对收益率来说：
  - 如果对数收益率 `log_ret` 接近正态分布，意味着：
    - 小涨小跌非常常见。
    - 极端暴涨/暴跌比较少见。
- 在本周的实践中，你会：
  - 用 `pandas.read_csv()` 读取 BTC 日线数据。
  - 计算简单收益率 `ret` 和对数收益率 `log_ret`。
  - 画出 `log_ret` 的直方图，看它是否大致像钟形曲线。

### 2.3 对交易的意义

- 如果收益率是正态分布，你可以：
  - 用“均值 ± 几个标准差”来估计波动区间；
  - 用标准差估计“风险大小”；
  - 做 Value at Risk（VaR）一类的风险度量会更简单。
- 现实里，**特别是加密市场**：
  - 常常会发现：尾巴比正态分布“更肥”（极端行情比想象多）。
  - 这意味着：**如果你盲信正态分布，很容易低估极端风险。**
- 本周的目标之一，就是：
  - 先感受“正态分布大概是什么样”；
  - 再用偏度、峰度去发现：真实市场数据**偏离正态**在哪儿。

---

## 3. 偏度、峰度与肥尾分布

### 3.1 偏度：分布向哪边歪？

#### 数学思想

- 偏度是一个数字，用来描述分布**是否对称**：
  - 偏度 = 0：左右基本对称（正态分布就是这样）。
  - 偏度 > 0：右尾更长，右边极端大值更多（正偏）。
  - 偏度 < 0：左尾更长，左边极端小值更多（负偏）。

#### 直观理解

- 直方图看起来：
  - 正偏：右边拖着长尾，好像更容易出现“突然暴涨”。
  - 负偏：左边拖着长尾，好像更容易出现“突然暴跌”。

#### 对交易的意义

- 对资产收益率来说：
  - **负偏度**往往意味着“尾部大跌的风险更大”，你要更注意止损和仓位控制。
  - **正偏度**可能代表有“偶尔爆赚”的机会，但也可能是数据样本太少或特定阶段造成的。
- 你在 Day 23 中会：
  - 用 `Series.skew()` 计算 BTC 收益率的偏度，看看它更容易“暴涨”还是“暴跌”。

### 3.2 峰度：分布有多尖、尾巴有多肥？

#### 数学思想

- 峰度衡量：
  - 分布在中心是不是更加“瘦高”；
  - 同时尾部是不是“更厚”，极端值是不是更多。
- 对正态分布：
  - 通常约定“峰度 = 3”（或“超额峰度 = 0”，只是减了一个常数）。

#### 直观理解

- 峰度高：
  - 中间更尖锐，两边尾巴更肥。
  - 大部分值仍集中在均值附近，但偶尔会出现非常大的偏离。
- 对收益率来说：
  - 峰度高意味着：**极端行情出现的频率比正态分布更高**。

#### 对交易的意义

- 对风控特别关键：
  - 如果某资产的收益率峰度很高，你不能用正态分布的“教科书风险估计”去套。
  - 实际上，极端暴跌可能会比模型估计地更频繁，止损/保证金设计需要更保守。
- 在 Day 23 中：
  - 你会用 `Series.kurt()` 计算 BTC 收益率的峰度；
  - 对比不同时间窗口（3 个月 / 1 年），看什么时候“风险更极端”。

### 3.3 肥尾分布：极端事件并不少见

#### 数学思想

- 肥尾分布：相对正态分布，尾部衰减更慢，极端值出现概率更高。
- 在金融里：
  - 肥尾几乎是常态，特别是高波动市场（比如加密、期货）。

#### 直观理解

- 若把真实收益率数据和理想正态分布对比：
  - 中间差不多，但尾部大量真实数据“跑到更远的位置”；
  - 图上看就是：尾部那边实测柱子比正态曲线更高。

#### 对交易的意义

- 肥尾 = 极端行情“并不那么罕见”：
  - 不能只靠“几倍标准差”来判断风险；
  - 回测要考虑“极端行情阶段”（例如黑天鹅、插针）。
- 本周迷你项目（BTC 收益率分布分析）就是让你：
  - 用直方图 + 偏度 + 峰度，体会 BTC 收益率是不是“肥尾”；
  - 对比不同时间段（牛市 / 熊市 / 震荡市），看肥尾程度是否不同。

---

## 4. 大数定律：平均值为什么会稳定？

### 4.1 数学思想

- 核心结论（工程师版）：
  - **同样的随机试验做得越多，样本平均值越接近真实平均值。**
- 条件大致是：
  - 每次试验独立；
  - 每次试验来自同样的分布（或差不多）。

### 4.2 直观理解

- 抛硬币例子：
  - 抛 10 次，可能正面 7 次，比例 0.7；
  - 抛 1000 次，比例往往会在 0.5 附近，更稳定。
- 对收益率来说：
  - 短期样本（比如只有 10 天收益）算出来的“平均收益率”很不稳定；
  - 样本越长，这个平均收益率越接近真实水平，但仍然**无法完全消除极端事件影响**。

### 4.3 对交易的意义

- 在回测中：
  - 如果样本很短，你算出来的“年化收益率、夏普比率”可能只是运气；
  - 样本更长，结果更有参考价值，但仍然不是“真理”。
- 在 Day 24 你会通过模拟感受：
  - 抛硬币次数增大时，“平均值轨迹”越来越平稳；
  - 这帮助你理解：为什么做策略评估时，要尽量使用更长的历史数据。

---

## 5. 中心极限定理：为什么“和/平均值”爱变成正态？

### 5.1 数学思想

- 核心结论（工程师版）：
  - **很多独立随机变量的和（或平均值），即使每个变量本身不是正态，它们的和/平均值往往会接近正态分布。**
- 直观理解：
  - 把许多小的“随机噪声”加起来，会产生日益“平滑”的结果，这种结果会“自动”靠近正态形状。

### 5.2 直观理解与模拟

- 你在 Day 24 中会：
  - 模拟很多次“日收益率”（可以是简单的随机数）；
  - 把多日收益率累加，观察：
    - 单日收益率的分布可能乱七八糟；
    - 多日累积收益率的分布会更接近正态。

### 5.3 对交易的意义

- 对“多周期收益率”的理解：
  - 单日波动很杂乱，但若假设每天的波动大致独立，则多天收益率的和更接近正态；
  - 这让一些基于“多期聚合”的风险估计更容易，比如简单放大日波动来估计周/月波动。
- 现实中的限制：
  - 金融时间序列往往**存在自相关、波动聚集**（比如大波动容易连续发生）；
  - 所以中心极限定理的条件并不完全满足，结果只是一种“近似”，不能过度依赖。

---

## 6. pandas 核心概念：把时间序列当“表格”来用

### 6.1 DataFrame / Series

#### 数学思想

- 可以把时间序列看成：
  - 一张表（DataFrame）：每一行是一条记录（某一天），每一列是一个变量（收盘价、收益率等）。
  - 一列数据（Series）：某个变量在所有时间点上的取值。

#### 直观理解

- `Series`：
  - 类似“带索引的一维数组”，比如“每天的收盘价”。
- `DataFrame`：
  - 多个 `Series` 拼在一起，形成“多列”的表格，比如“开高低收 + 成交量 + 收益率”。

#### 对交易的意义

- 你可以：
  - 方便地在列之间做运算（比如用收盘价算收益率列）；
  - 用行索引（日期）筛选特定时间区间。

### 6.2 索引：loc / iloc 与时间索引

#### 数学思想

- 索引是“告诉 pandas 这一行是谁”的标签。
  - 可以是整数（第几行）；
  - 也可以是日期（某一天的数据）。

#### 直观理解

- `loc`：按“标签”取数据，例如：
  - `df.loc['2021-01-01']` → 取 2021-01-01 那一行。
- `iloc`：按“位置”取数据，例如：
  - `df.iloc[0]` → 取第一行。

#### 时间索引的意义

- 通过 `to_datetime` 转成时间、`set_index` 把日期设为索引后，你可以：
  - 直接用 `df['2021-01-01':'2021-12-31']` 选取全年数据；
  - 按年份、按月份、按周做各种统计和重采样。

### 6.3 缺失值处理：dropna 与 fillna

#### 数学思想

- 缺失值代表：这个时间点的某个数据“不知道是多少”。
- 如果不处理，很多运算（均值、方差、绘图）会受到影响或直接报错。

#### 直观理解

- `dropna()`：直接把含有缺失值的行丢掉。
  - 好处：简单粗暴，不会凭空“编造数据”。
  - 风险：如果缺失太多，样本会变得很少。
- `fillna()`：用某种规则填补，例如：
  - 用前一个已知值填补（前向填充）；
  - 用 0 或均值填补等。

#### 对交易的意义

- 对价格序列：
  - 常见做法是前向填充（假设中间没交易则价格不变）。
- 对收益率序列：
  - 通常更谨慎，很多时候宁愿 `dropna` 而不是凭空填数字。
- 在 Day 25 中，你会：
  - 对 BTC 日线数据做缺失值处理；
  - 再用 `describe()` 看基本统计量，为后续分布分析做准备。

### 6.4 重采样（resample）：从日线到周线、月线

#### 数学思想

- 重采样就是“改变时间频率”：
  - 从高频 → 低频：例如日线 → 周线、月线；
  - 在新频率上做聚合（比如取一周内的最后一个收盘价）。

#### 直观理解

- 日线 K 线图：每天波动很多，看久了很吵。
- 周线 / 月线：把一段时间的信息折叠成一个点或一根 K 线，可以更清楚地看长期趋势。

#### 对交易的意义

- 你可以：
  - 用周线观察中期趋势，用月线观察长期趋势；
  - 比较日度波动和周度波动的差异。
- 在 Day 26：
  - 你会用 `resample('W')`、`resample('M')` 对 BTC 数据做重采样；
  - 计算周/月收益率，为后面分析“不同时间尺度的波动”做准备。

### 6.5 滚动窗口（rolling）：观察“最近 N 天”的特征

#### 数学思想

- 滚动窗口就是：
  - 取“最近 N 天”作为一个小样本；
  - 在这个小样本上计算均值、标准差等；
  - 窗口每天往前滑，得到一条时间序列。

#### 直观理解

- 类比：
  - 你每天回顾“过去 30 天自己的作息/心情”，就会得到一条“最近状态”的曲线。
- 对收益率：
  - `rolling(window=20).mean()`：看过去 20 天平均收益；
  - `rolling(window=20).std()`：看过去 20 天波动率（波动大小）。

#### 对交易的意义

- 滚动波动率：
  - 可以看出市场什么时候“突然变得很剧烈”；
  - 这在风控、杠杆调整上很重要。
- 在本周的实践中：
  - 你会计算 7 日、30 日滚动波动率；
  - 画出价格 + 滚动波动率的子图，对比“行情剧烈时期”和“平静时期”。

---

## 7. 本周理论如何串到迷你项目？

### 7.1 Day 22：用 BTC 收益率感受分布

- 目标：
  - 把“收益率分布”从抽象概念变成眼前的直方图。
- 关键步骤：
  - 读取 BTC 日线数据，设置日期索引；
  - 计算简单收益率和对数收益率；
  - 画出直方图，看是否近似钟形。
- 理论对应：
  - 正态分布的形状；
  - 收益率的“中心”和“分散程度”。

### 7.2 Day 23：给分布加上“偏度、峰度”的度量

- 目标：
  - 用偏度和峰度，用数字描述“这条分布歪不歪、尾巴肥不肥”。
- 关键步骤：
  - 在不同时间窗口上计算 BTC 收益率的偏度、峰度；
  - 对比不同阶段的直方图。
- 理论对应：
  - 偏度：暴涨多，还是暴跌多？
  - 峰度：极端行情发生频率是否高于正态假设？

### 7.3 Day 24：用模拟体会大数定律 & 中心极限定理

- 目标：
  - 不看严谨证明，只用代码实验感受“平均值会收敛、和会趋向正态”。
- 关键步骤：
  - 抛硬币模拟：增加实验次数，观察均值的稳定性；
  - 模拟“日收益率”，看多日收益率之和/均值的分布变化。
- 理论对应：
  - 大数定律：样本均值越来越稳定；
  - 中心极限定理：多期收益率的聚合更接近正态。

### 7.4 Day 25–26：用 pandas 夯实数据操作

- 目标：
  - 把 BTC 日线数据变成“随手就能分析”的格式。
- 关键步骤：
  - 熟悉 `DataFrame` / `Series`、`loc` / `iloc`、时间索引；
  - 做缺失值处理；
  - 使用 `resample` 和 `rolling` 计算各种统计量。
- 理论对应：
  - 时间索引的意义；
  - 重采样和滚动窗口的直觉和用途。

### 7.5 周末迷你项目：BTC 收益率分布分析

- 项目目标：
  - 检验 BTC 日收益率是否可以近似看成正态分布；
  - 分析不同时间窗口内分布形状的变化。
- 你会做的事：
  - 选取长期样本（例如 3–5 年）；
  - 计算对数收益率，切成若干时间段（按年份或牛熊周期）；
  - 每个时间段：画直方图，计算均值、标准差、偏度、峰度；
  - 画出多个子图对比不同时间段的分布；
  - 写一段文字分析：哪段时期更“平稳”，哪段时期极端波动更多？
- 这串起来的理解：
  - 正态分布是一个“理想模板”；
  - 真实市场往往有偏度和肥尾；
  - 不同阶段的“尾部风险”并不一样，策略和仓位也不应该一刀切。

---

## 8. 学完本周理论后，你应该能做到

- **用自己的话解释**：
  - 什么是收益率分布，它和价格分布有啥不同；
  - 正态分布大概长什么样，为什么很多模型喜欢假设正态；
  - 偏度、峰度分别在描述什么；
  - 肥尾意味着什么样的极端风险。
- **能从工程角度理解**：
  - 为什么要看收益率而不是直接看价格；
  - 为什么要计算多日累积收益率、滚动波动率；
  - 为什么样本太短的回测结果不可靠。
- **能在代码中完成**：
  - 用 pandas 读取 BTC 日线数据，并转换为带时间索引的 DataFrame；
  - 计算收益率、偏度、峰度，并画出分布直方图；
  - 使用重采样和滚动窗口观察不同时间尺度的波动特征。

当这些点都能讲给“完全不懂数学的同事”听懂时，你的第 1 周理论目标就已经达成了。
