# 实战数学清单 · 学习笔记

---

## 一、收益与分布（最核心）

### 1.1 简单收益率（simple return）与对数收益率（log return）

#### 1.1.1 专业版

设第 $t-1$ 期价格为 $P_{t-1}$，第 $t$ 期价格为 $P_t$。

- **简单收益率**（simple return）：

$$
 r_t = \frac{P_t - P_{t-1}}{P_{t-1}} = \frac{P_t}{P_{t-1}} - 1.
$$

- **对数收益率**（log return）：

$$
 \ell_t = \ln \left( \frac{P_t}{P_{t-1}} \right).
$$

- 二者关系：当收益率较小（例如 $|r_t| < 0.1$）时，有近似关系：

$$
 \ell_t \approx r_t - \tfrac{1}{2} r_t^2 \approx r_t.
$$

- **时间可加性（additivity over time）**：
  - 简单收益率在时间上**不可直接相加**，而是连续相乘：

$$
 1 + R_{0\to T} = \prod_{t=1}^T (1 + r_t).
$$

  - 对数收益率在时间上**可以相加**：

$$
 \sum_{t=1}^{T} \ell_t = \ln \left( \prod_{t=1}^{T} \frac{P_t}{P_{t-1}} \right) = \ln \left( \frac{P_T}{P_0} \right).
$$

这也是为什么在建模和画分布时，经常对价格先取对数、或直接对对数收益率做分析。

#### 1.1.2 通俗版

- 简单收益率就是“涨了 / 跌了多少百分比”：
  - 从 100 涨到 110：
    - $r = (110/100 - 1) = 0.1 = 10\%$。
- 对数收益率可以理解成：**把“涨跌”连续地累加起来的一个数学写法**。
  - 它对“连续涨跌很多期”的场景更友好：直接加总对数收益率，就等于看总的涨倍数。

直觉上：

- **做回测**：日度、分钟级别的数据，`r` 不大时，简单收益率和对数收益率差别不大；
- **做建模 & 统计分析**：用对数收益率通常更平滑、更接近正态分布、时间可加，所以比较方便。

> 你可以记一个经验：
> - 做“策略结果展示”：常用简单收益率（用户更好理解）。
> - 做“数学分析 / 建模”：常用对数收益率。

---

### 1.2 分布（distribution）、直方图（histogram）与经验分布（empirical distribution）

#### 1.2.1 专业版

给定一组收益率样本 $r_1, r_2, \dots, r_N$：

- **经验分布**：把这 $N$ 个样本视为来自某个随机变量 $R$ 的观测值，它们的“整体形状”就是 $R$ 的经验分布。
- **直方图**（histogram）：
  - 把收益率区间划成若干个小区间（bin）；
  - 统计每个区间里落入的样本个数，画成柱状图。

常见指标：

- **样本均值**（sample mean）：

$$
 \bar r = \frac{1}{N} \sum_{t=1}^N r_t.
$$

- **样本标准差**（sample standard deviation）：

$$
 s = \sqrt{\frac{1}{N-1} \sum_{t=1}^N (r_t - \bar r)^2}.
$$

#### 1.2.2 通俗版

- 把每一天（或每一分钟）的收益率，看成一次“掷骰子”的结果。
- 我们把很多天的结果堆在一起，
  - 看“平均值”大概是多少；
  - 看“有多抖”：是不是经常大涨大跌。

直方图其实就是：

- 把收益率从“最亏”到“最多赚”分成很多小格子；
- 看每个格子里有多少天落在这里。

你只要能看懂：

- 左边长尾：经常有很大的亏损；
- 右边长尾：经常有很大的盈利；
- 柱子靠中间且集中：波动比较小，比较稳。

---

## 二、基础概率直觉

### 2.1 随机变量（random variable）、期望（expectation）与方差（variance）

#### 2.1.1 专业版

- **随机变量 $X$**：
  - 在概率空间上定义的一个函数，每次实验会产生一个数值结果。

- **期望** $\mathbb{E}[X]$：
  - 离散情形：

$$
 \mathbb{E}[X] = \sum_i x_i \, \mathbb{P}(X = x_i).
$$

  - 连续情形：

$$
 \mathbb{E}[X] = \int_{-\infty}^{+\infty} x f_X(x) \, \mathrm{d}x.
$$

- **方差** $\mathrm{Var}(X)$ 与标准差 $\sigma$：

$$
 \mathrm{Var}(X) = \mathbb{E}\big[(X - \mathbb{E}[X])^2\big], \quad \sigma = \sqrt{\mathrm{Var}(X)}.
$$

在量化里，一般把策略的单期收益率记成随机变量 $R$：

- $\mathbb{E}[R]$ 衡量“长期平均收益”；
- $\mathrm{Var}(R)$ 或 $\sigma(R)$ 衡量“收益不稳定的程度（波动）”。

#### 2.1.2 通俗版

- 随机变量就是“每次试一试会出一个数”的东西。
  - 例：每天的收益率、每天的涨跌点数。
- 期望可以理解为：
  - 做很多很多次之后的“平均结果”。
- 方差 / 标准差可以理解为：
  - 结果在平均值附近“晃动”的程度。

> 有 edge 的策略：
> - 把每天收益看成随机变量 $R$，期望 $\mathbb{E}[R]$ 要为正；
> - 但同时波动（标准差）也不能大到你心理扛不住。

---

### 2.2 大数定律（law of large numbers）与中心极限定理（central limit theorem）

#### 2.2.1 专业版

设 $X_1, X_2, \dots, X_N$ 是同分布、独立（i.i.d.）的随机变量，且

$$
 \mathbb{E}[X_i] = \mu, \quad \mathrm{Var}(X_i) = \sigma^2 < +\infty.
$$

- **大数定律**：当 $N \to \infty$ 时，样本均值收敛到真实期望：

$$
 \bar X_N = \frac{1}{N} \sum_{i=1}^N X_i \to \mu.
$$

- **中心极限定理**：当 $N$ 足够大时，标准化后的样本均值近似服从正态分布：

$$
 \sqrt{N} \left(\bar X_N - \mu\right) \xrightarrow{d} \mathcal{N}(0, \sigma^2).
$$

#### 2.2.2 通俗版

- **大数定律**：
  - 重复做同一件“随机的事”，次数足够多之后，平均结果会越来越稳定，越来越接近真实水平。
  - 对量化来说：回测样本数越多，统计结果越可靠。

- **中心极限定理**：
  - 很多“小随机波动”加到一起，整体看起来往往接近“钟形”的正态分布。

> 直觉：
> - 短期看，一切都像噪声；
> - 长期看，平均值会慢慢显露出来。

---

## 三、分布形状与尾部风险

### 3.1 偏度（skewness）、峰度（kurtosis）与厚尾（fat tail）

#### 3.1.1 专业版

给定随机变量 $X$，记其均值为 $\mu$，标准差为 $\sigma$。

- **偏度**（skewness）：衡量分布的左右不对称性。

$$
 \mathrm{Skew}(X) = \mathbb{E}\left[\left( \frac{X - \mu}{\sigma} \right)^3\right].
$$

  - $\mathrm{Skew} > 0$：右偏，右尾更长；
  - $\mathrm{Skew} < 0$：左偏，左尾更长。

- **峰度**（kurtosis）：衡量分布的尖峭程度和尾部厚度。

常用的是**过度峰度**（excess kurtosis）：

$$
 \mathrm{Kurt}(X) = \mathbb{E}\left[\left( \frac{X - \mu}{\sigma} \right)^4\right] - 3.
$$

  - 正态分布的过度峰度为 0；
  - $\mathrm{Kurt} > 0$：比正态“更尖、更厚尾”。

“厚尾”（fat tail）指的是：

- 尾部（极端大亏或大赚）的概率比正态分布高。

#### 3.1.2 通俗版

- 偏度：看尾巴偏哪边。
  - 左偏：大亏的情况出现得更频繁或更严重；
  - 右偏：大赚的情况更常见。
- 峰度 / 厚尾：看“极端情况”有多容易发生。
  - 厚尾 = “黑天鹅”更多、极端事件更频繁。

> 策略层面：
> - 小赚大亏的“卖保险型策略”：一般左偏、厚尾；
> - 看上去很稳，但偶尔一口气亏好几年赚的钱，这种就是典型厚尾风险。

---

### 3.2 极端值与 VaR（Value-at-Risk）直觉

#### 3.2.1 专业版

设投资组合单期收益为随机变量 $R$，给定置信水平 $\alpha$（如 $95\%$）。

- **分位数**（quantile）：
  - $q_\alpha$ 满足：

$$
 \mathbb{P}(R \le q_\alpha) = 1 - \alpha.
$$

- **VaR**（Value-at-Risk，风险价值）：
  - 在置信水平 $\alpha$ 下的最大损失（简化理解）：

$$
 \mathrm{VaR}_\alpha = -q_\alpha.
$$

直观读法：

- 在 $\alpha = 95\%$ 的情况下，“有 95% 的概率损失不会超过 VaR”。

#### 3.2.2 通俗版

- VaR 就是在问：
  - “正常情况下（比如 95% 的时间），我最多会亏到什么程度？”
- 比如：
  - 日度 $95\%$ VaR = 2%，可以读成：
    - “绝大多数日子（95%）里，单日亏损不会超过 2%；但剩下 5% 的日子可能更惨。”

> VaR 不告诉你“最惨到底多惨”，但它是一个简单、常用的风险预算工具。

---

## 四、相关性与线性回归

### 4.1 协方差（covariance）与相关系数（correlation）

#### 4.1.1 专业版

给定两个随机变量 $X$ 和 $Y$，记均值分别为 $\mu_X$，$\mu_Y$，标准差为 $\sigma_X$，$\sigma_Y$。

- **协方差**：

$$
 \mathrm{Cov}(X, Y) = \mathbb{E}[(X - \mu_X)(Y - \mu_Y)].
$$

- **相关系数**：

$$
 \rho_{X,Y} = \frac{\mathrm{Cov}(X, Y)}{\sigma_X \sigma_Y}, \quad -1 \le \rho_{X,Y} \le 1.
$$

性质：

- $\rho_{X,Y} > 0$：同向波动为主；
- $\rho_{X,Y} < 0$：反向波动为主；
- $\rho_{X,Y} \approx 0$：线性相关性不明显。

#### 4.1.2 通俗版

- 协方差和相关系数回答的问题是：
  - “这两个东西，是不是经常一起涨、一起跌？”

- 相关系数：
  - 接近 1：高度同涨同跌；
  - 接近 -1：一个涨一个跌；
  - 接近 0：互相没什么线性关系。

> 用处：
> - 资产组合：挑相关性低的资产，能更好分散风险；
> - 因子研究：看两个因子是不是实质一样，避免“换皮因子”。

---

### 4.2 一元 / 多元线性回归（linear regression）

#### 4.2.1 专业版

- 一般形式：

$$
 y = a + b_1 x_1 + b_2 x_2 + \cdots + b_k x_k + \varepsilon,
$$

其中：

- $y$：被解释变量（如未来收益）；
- $x_1, \dots, x_k$：解释变量 / 自变量（如因子暴露、特征）；
- $a$：截距（intercept）；
- $b_i$：回归系数（regression coefficient）；
- $\varepsilon$：残差（residual）。

- 常用指标：
  - $b_i$ 的符号和大小：
    - 符号表示正向 / 反向关系；
    - 大小表示单位变化带来的影响幅度（在其他变量不变的前提下）。
  - $R^2$：解释了多少波动（explained variance ratio）。

#### 4.2.2 通俗版

- 线性回归做的事：
  - “用若干个输入变量 $x_1, x_2, \dots$ 来预测 $y$”。
- 比如：
  - $y$ = 明天收益；
  - $x_1$ = 当前动量因子；
  - $x_2$ = 估值因子；
  - $x_3$ = 波动率因子；
  - 回归系数 $b_1, b_2, b_3$ 告诉你“每个因子对收益的边际贡献方向和强度”。

> 回归在量化里的常见用途：
> - 做因子回归，评估一个因子是不是“真有效”；
> - 做预收益预测的 baseline 模型（即最简单、易解释的版本）。

---

## 五、时间序列直觉

### 5.1 自相关（autocorrelation）与滞后（lag）

#### 5.1.1 专业版

对一个时间序列 $\{x_t\}$，对给定的滞后阶数 $k$，其自协方差与自相关系数定义为：

- 自协方差：

$$
 \gamma(k) = \mathrm{Cov}(x_t, x_{t-k}).
$$

- 自相关系数：

$$
 \rho(k) = \frac{\gamma(k)}{\gamma(0)}.
$$

“滞后 $k$”就是把序列向后平移 $k$ 期，如 $x_{t-1}, x_{t-2}$ 等。

#### 5.1.2 通俗版

- 自相关在问：
  - “今天的值，和昨天、前天的值，有没有关系？”
- 若短期自相关为正：
  - 代表有“惯性 / 趋势”的味道；
- 若短期自相关为负：
  - 代表有“反转 / 均值回归”的味道。

> 实战上：
> - 看收益序列的自相关，可以判断这个品种更偏趋势还是偏震荡；
> - 设计策略时，要小心不要引入“用未来数据”的滞后（避免 data leakage）。

---

### 5.2 移动平均（moving average）与滚动窗口（rolling window）

#### 5.2.1 专业版

- 长度为 $n$ 的简单移动平均（SMA）：

$$
 \mathrm{SMA}_t = \frac{1}{n} \sum_{i=0}^{n-1} x_{t-i}.
$$

- **滚动窗口**：
  - 对时间序列的每一个时间点，取一个固定长度的窗口（如最近 20 天）；
  - 在这个窗口内计算均值、标准差、最大值等统计量。

窗口长度的影响：

- 窗口越短：更敏感、但噪声更多；
- 窗口越长：更平滑、但反应更慢（更“滞后”）。

#### 5.2.2 通俗版

- 移动平均就是“最近 $n$ 天的平均值”，每天往前滚一步。
- 滚动标准差就是“最近 $n$ 天有多抖”。

> 策略意义：
> - 均线策略：价格在某条均线上下穿越 -> 可能触发交易信号；
> - 波动率分 regime：最近波动很大 / 很小，用来调整仓位或切换策略参数。

---

### 5.3 简单 AR(1) 模型（autoregressive model of order 1）

#### 5.3.1 专业版

AR(1) 模型的形式：

$$
 x_t = a + b x_{t-1} + \varepsilon_t,
$$

其中：

- $a$：常数项；
- $b$：自回归系数；
- $\varepsilon_t$：白噪声，通常假设独立同分布，均值为 0。

性质：

- 若 $|b| < 1$，序列是均值回归的（mean-reverting）；
- 若 $b > 0$，存在正的自相关，体现趋势惯性；
- 若 $b < 0$，体现震荡 / 反转特性。

#### 5.3.2 通俗版

- AR(1) 就是在说：
  - “今天的值 ≈ 常数 + 昨天的值 × 系数 + 噪声”。
- 如果 $b$ 接近 1：
  - 今天和昨天很像，趋势惯性强；
- 如果 $b$ 接近 -1：
  - 今天倾向于跟昨天反着来，更像“来回震荡”。

> 实战中：
> - 可以用 AR(1) 来粗糙地刻画一个品种是偏趋势还是偏均值回归；
> - 也可以用在某些信号上，看“信号的持续性”如何。

---

## 六、风险指标与绩效评估

### 6.1 年化收益（annualized return）与年化波动率（annualized volatility）

#### 6.1.1 专业版

设单期简单收益率为 $r_t$，$t = 1, \dots, N$。

- **累计收益**（总收益率）：

$$
 R_{\mathrm{total}} = \prod_{t=1}^{N} (1 + r_t) - 1.
$$

- 若每个交易日长度相同，且一年有 $D$ 个交易日，则：

  - **年化收益率**（以日频为例）：

$$
 R_{\mathrm{ann}} = (1 + R_{\mathrm{total}})^{\frac{D}{N}} - 1.
$$

- **样本标准差**：

$$
 s = \sqrt{\frac{1}{N-1} \sum_{t=1}^N (r_t - \bar r)^2}.
$$

- **年化波动率**：

$$
 \sigma_{\mathrm{ann}} = s \sqrt{\frac{D}{\Delta}},
$$

其中 $\Delta$ 是采样间隔对应的“日数”（日频取 $\Delta = 1$；若是分钟频，需要换算成日）。

#### 6.1.2 通俗版

- 年化收益：
  - 把你在一段时间内赚到的钱，换算成“如果这样的表现持续一年，大概是一年赚多少”。
- 年化波动率：
  - 把短期的“抖动程度”换算成“如果一年都这样抖，大概一年会有多抖”。

> 对比两个策略时：
> - 不能只看收益，也要看波动；
> - “高收益 + 高波动” 不一定比 “中等收益 + 低波动” 更好。

---

### 6.2 夏普比率（Sharpe Ratio）

#### 6.2.1 专业版

给定策略单期收益率为 $r_t$，无风险利率为 $r_f$（可近似为 0），则：

- 单期超额收益：

$$
 r_t^{\mathrm{excess}} = r_t - r_f.
$$

- 样本均值与标准差：

$$
 \bar r_{\mathrm{excess}} = \frac{1}{N} \sum_{t=1}^N r_t^{\mathrm{excess}}, \quad s_{\mathrm{excess}} = \sqrt{\frac{1}{N-1} \sum_{t=1}^N (r_t^{\mathrm{excess}} - \bar r_{\mathrm{excess}})^2}.
$$

- 年化夏普比：

$$
 \mathrm{Sharpe}_{\mathrm{ann}} = \frac{\bar r_{\mathrm{excess}}}{s_{\mathrm{excess}}} \sqrt{\frac{D}{\Delta}}.
$$

#### 6.2.2 通俗版

- 夏普比在回答：
  - “在单位风险（波动）下，这个策略能赚多少收益？”
- 夏普越高：
  - 说明用同样的“心理承受力”，能换来更高的收益。

> 策略筛选时：
> - 夏普是最常用的第一道过滤指标之一；
> - 但不能只看夏普，还要结合最大回撤、尾部风险等一起看。

---

### 6.3 最大回撤（max drawdown）与回撤持续时间（drawdown duration）

#### 6.3.1 专业版

设 $\{V_t\}$ 为权益曲线（净值）。定义：

- 历史最高净值：

$$
 H_t = \max_{0 \le s \le t} V_s.
$$

- 回撤（drawdown）：

$$
 \mathrm{DD}_t = \frac{V_t - H_t}{H_t}.
$$

- 最大回撤：

$$
 \mathrm{MDD} = \min_t \mathrm{DD}_t.
$$

- 回撤持续时间：从一个高点跌下去，到再次创出新高之间所经历的期数（可以用天数、交易日等记录）。

#### 6.3.2 通俗版

- 最大回撤：
  - “从历史最高点算起，你曾经一口气最多亏了多少？”
- 回撤持续时间：
  - “从高点跌下去，到重新回到这个高度，花了多长时间？”

> 现实中：
> - 很多人不是死在“亏了多少”，而是死在“亏了多久都回不来”。
> - 这两个指标直接决定你是否能心理上扛得住策略的表现。

---

## 七、资金管理与简单优化

### 7.1 仓位（position size）、杠杆（leverage）与风险 / 收益关系

#### 7.1.1 专业版

- 若策略在基础单位仓位下单期收益率为 $r_t$，当你使用仓位系数 $w$（含杠杆）时，单期收益率近似变为：

$$
 r_t^{(w)} \approx w \cdot r_t.
$$

- 期望收益与波动率的变化：

$$
 \mathbb{E}[r_t^{(w)}] = w \cdot \mathbb{E}[r_t], \quad \sigma[r_t^{(w)}] = |w| \cdot \sigma[r_t].
$$

- 当 $w$ 过大时：
  - 虽然期望收益按比例放大；
  - 但尾部亏损也按比例放大，爆仓（资金归零）概率迅速上升。

#### 7.1.2 通俗版

- 仓位就像你“压上多少钱”：
  - 下 1 手 vs 下 10 手，本质是把同一个策略按比例放大。
- 杠杆是“借钱放大”：
  - 同样的信号，如果你借钱翻倍开仓，收益和亏损都翻倍。

> 核心直觉：
> - 仓位不是越大越好；
> - 仓位开得大，赚钱的时候爽，但遇到极端行情时，亏损速度也会非常快，甚至直接爆仓。

---

### 7.2 Kelly 公式（Kelly criterion）的直觉

#### 7.2.1 专业版

考虑一个简单的“二元赌局”：

- 以概率 $p$ 获得盈亏比为 $R$ 的盈利：赢时收益为 $+R$；
- 以概率 $1-p$ 亏损 1：输时收益为 $-1$；
- 每次下注使用资金的比例为 $f$。

在一些理想化假设下，可以推导出最大化长期增长率的最优下注比例：

$$
 f^* = \frac{p(R + 1) - 1}{R}.
$$

当 $R = 1$ 时（盈亏对称）：

$$
 f^* = 2p - 1.
$$

这个 $f^*$ 就是所谓的 **Kelly 比例**。

实务中：

- 全 Kelly 常常过于激进；
- 实际操盘往往使用 $\tfrac{1}{4}$ 到 $\tfrac{1}{2}$ Kelly 作为上限参考。

#### 7.2.2 通俗版

- Kelly 在回答一个问题：
  - “我有一个长期有优势（edge）的游戏，每次应该压多少比例的资金，才能让资金长期增长最快？”

- 背后的结论：
  - 如果你每次压得太少：增长太慢；
  - 压得太多：一旦连续几次坏运气，资金回撤会非常大，甚至无法恢复。

> 对你来说：
> - 不需要推导公式，只要知道：
>   - Kelly 给出了一个“理论上的仓位上限”；
>   - 实际执行时应保守使用，比如 1/4~1/2 Kelly。

---

## 八、暂时可以不当重心的部分

### 8.1 高阶数学工具（当前先略过）

以下内容在严谨理论或复杂衍生品定价中很重要，但对你当前“做策略 + 回测 + 风控”的阶段可以先不当重心：

- 测度论（measure theory）、严谨概率论体系；
- 随机微积分（stochastic calculus，如 Ito 公式、随机微分方程 SDE）；
- 复杂数值优化理论（如系统的凸优化工具箱）。

> 建议：
> - 先把本笔记中的核心概念吃透，并在代码里用起来；
> - 真正遇到“现有工具不够用”的时候，再回头系统补这些高级数学会更有效率。

---

## 九、如何用这份笔记学习

1. **按模块循环**：
   - 每次只挑一个小节（如“简单收益率 vs 对数收益率”），
   - 先读“专业版”，把公式和术语记在脑子里；
   - 再读“通俗版”，在脑中找现实类比。
2. **边学边算**：
   - 用 Python / Notebook 写出对应公式的计算代码；
   - 对真实行情数据算直方图、均值、标准差、相关系数等。
3. **对接策略与回测**：
   - 每掌握一个概念，就问自己：
     - “在我的策略或回测里，这个概念出现在哪里？”
     - “我现在是怎么处理它的？有没有更合理的方式？”

只要能把这些“够用数学”吃透，你就已经具备搭建个人量化系统的坚实基础。
