# 阶段 2：经典策略原型 + 回测与评估（按每 2 周拆分的学习计划）

> 覆盖总时长：建议 6–10 周，这里按「2 周 = 1 块」设计 4 块主线 + 1 块机动迭代。
> 默认你每天可以投入 1–3 小时，如果某段时间更忙，可以把每块周期拉长。

---

## 总体目标回顾

- 至少实现并理解 2–3 个策略原型：
  - 趋势跟随（动量、均线突破）。
  - 均值回归（布林带、简单 pairs 思路）。
  - 简单波动率策略（高波动减仓、低波动加仓）。
- 跑通一次较完整的回测流程：
  - 读数据 → 生成信号 → 仓位与交易 → 加手续费/滑点 → 绩效评估。
- 能用「交易视角」去解读回测报表：
  - 资金曲线、最大回撤、年化收益、Sharpe、交易次数、胜率等。

---

## 第 0 块（可与阶段 1 后半段交叉）：回测框架预热（1–2 天）

> 如果你已经选好/用过框架，可直接略读，重点放在后面 4 块。

- **目标**
  - 选定阶段 2 主力回测框架（`backtrader` 或 `vectorbt`）。
  - 跑通「读 BTC/USDT 日线数据 + 计算简单策略收益」的最小 demo。

- **具体任务**
  - 任务 0-1：环境检查
    - 确认 Python 版本、虚拟环境、依赖安装正常。
    - 把框架加入 `requirements.txt`。
  - 任务 0-2：Hello, Backtest
    - 用框架官方/社区最简单示例代码，读入一只标的的历史数据，跑一个非常简单的策略（例如永远持有/简单移动均线），并生成一条资金曲线。
  - 任务 0-3：记录
    - 在 `docs/notes/` 下写一篇「回测框架最小笔记」，记录：
      - 代码入口在哪里？
      - 数据是怎么喂进去的？
      - 策略逻辑写在哪个类/函数里？

---

## 第 1 块（第 1–2 周）：趋势跟随原型 + 单标的双均线回测

- **本块核心问题**
  - 趋势跟随是怎么赚钱 / 在什么行情被教育？
  - 如何在回测框架里，从「中文规则」变成「可运行策略类/函数」？

- **阶段目标**
  - 搞清楚趋势跟随策略的基本逻辑和风险点。
  - 在回测框架中实现「单标的双均线趋势策略」，并完成基础回测。

- **建议知识点（穿插学，不需要一次学完）**
  - 回顾阶段 1 的：
    - 简单 & 指数移动平均（SMA / EMA）。
    - 滚动窗口（rolling）概念。
  - 回测相关：
    - bar / candle、open/high/low/close/volume。
    - 回测中一笔交易的生命周期：开仓 → 持仓 → 平仓。

- **具体任务拆解**
  - 任务 1-1：策略画像
    - 用你自己的话写出趋势跟随策略的画像：
      - 赚谁的钱？
      - 适合什么行情 / 在什么行情失效？
      - 主要风险和可能的大坑？
  - 任务 1-2：中文规则 → 伪代码
    - 以「20 日均线上穿 60 日均线做多，下穿平仓」为例：
      - 用自然语言写清楚完整规则（建仓、平仓、是否允许反手、是否空仓）。
      - 把这套规则翻译成伪代码（if/else + 循环结构）。
  - 任务 1-3：伪代码 → 回测代码
    - 在选定回测框架中实现策略：
      - 实现信号生成：短均线、长均线、金叉、死叉。
      - 实现交易执行：开仓/平仓、仓位大小（可先用固定 100% 仓位）。
      - 跑一个标的（BTC/USDT 日线）。
  - 任务 1-4：初步评估 + 笔记
    - 输出：资金曲线、基础指标（总收益、最大回撤、年化收益、Sharpe，如果框架支持）。
    - 写一篇小复盘：
      - 在哪些年份/区间表现好？
      - 在哪些区间频繁假突破？
      - 从交易者视角看，这个策略像什么风格的选手？

---

## 第 2 块（第 3–4 周）：均值回归原型 + 布林带策略

- **本块核心问题**
  - 均值回归和趋势跟随的「世界观」有什么根本差别？
  - 如何让策略「在震荡市吃肉，在趋势市少被砍头」？

- **阶段目标**
  - 理解布林带（Bollinger Bands）的构成与含义。
  - 实现一个基于布林带的均值回归策略，并与趋势策略做对比。

- **建议知识点**
  - 布林带：
    - 中轨：N 日移动平均。
    - 上下轨：中轨 ± k × N 日收益率或价格的标准差。
  - 回顾阶段 1 中的：
    - 标准差（standard deviation）、波动率的直觉。

- **具体任务拆解**
  - 任务 2-1：策略画像
    - 用你自己的话写出均值回归策略的画像：
      - 逻辑和趋势跟随相比，最大的区别是什么？
      - 在什么情景下容易连续亏损？
  - 任务 2-2：布林带指标实现
    - 在回测/数据分析代码中实现：
      - 中轨：N 日移动平均。
      - 上轨/下轨：中轨 ± k × 滚动标准差。
    - 画图：价格 + 三条轨道，以肉眼感受「偏离程度」。
  - 任务 2-3：布林带回归策略实现
    - 策略示例：
      - 价格跌破下轨：开多（赌回归中轨）。
      - 价格回到中轨附近：平多。
      - 价格突破上轨：开空（如果你考虑做空），回到中轨平空。
    - 在同一标的（BTC/USDT）上回测。
  - 任务 2-4：与趋势策略对比
    - 选几个阶段：明显趋势段 vs 明显震荡段。
    - 对比：两种策略在这两个阶段的表现（收益、回撤、交易次数）。
    - 写一篇小总结：
      - 哪种策略更「顺势」，哪种更「贪便宜」？
      - 如果你必须在某种行情只选一个策略，你会怎么选？

---

## 第 3 块（第 5–6 周）：波动率调仓策略 + 回测原则深化

- **本块核心问题**
  - 波动率如何影响仓位大小与风险暴露？
  - 如何在回测中避免明显的「未来函数 / 数据泄露」？

- **阶段目标**
  - 构建一个简单的「高波动减仓、低波动加仓」规则。
  - 将波动率模块叠加在前面一个已有策略上（趋势或均值回归）。
  - 深入理解并实操几个关键回测原则。

- **建议知识点**
  - 波动率与滚动标准差：
    - 用滚动标准差刻画「近期是否剧烈波动」。
  - 回测原则：
    - 避免未来函数：只用当前及历史信息，不窥探未来价格。
    - 数据泄露：训练集/测试集边界，不能在样本外偷看参数。
    - 样本内 / 样本外分割；简单 walk-forward 思想。

- **具体任务拆解**
  - 任务 3-1：波动率 regime 划分
    - 用滚动标准差，把市场简单分为：
      - 低波动区间、中等波动区间、高波动区间。
    - 可视化：颜色区分不同 regime，叠加在价格曲线上。
  - 任务 3-2：波动率调仓规则设计
    - 示例模板：
      - 低波动：满仓（或高仓位）。
      - 中等波动：中等仓位。
      - 高波动：低仓位或观望（甚至强制减仓）。
    - 用自然语言写清规则，再转成伪代码。
  - 任务 3-3：叠加到已有策略
    - 从趋势或布林带策略中选一个，作为「底层信号策略」。
    - 在其之上加入波动率调整模块：
      - 信号决定方向（多/空/平）。
      - 波动率模块决定仓位大小。
  - 任务 3-4：回测原则自查
    - 检查当前所有策略代码：
      - 是否使用未来价格/未来指标信息？
      - 样本切分是否清晰（比如按时间分训练/测试）？
    - 写一份「回测自查 checklist」，以后每个新策略都过一遍。

---

## 第 4 块（第 7–8 周）：综合复盘 + 简单样本外验证

- **本块核心问题**
  - 你的策略在「没见过的区间」表现如何？
  - 哪些表现是噪音，哪些是稳定特征？

- **阶段目标**
  - 对已经实现的 2–3 个策略做一轮统一复盘。
  - 做最简单版本的样本外验证：
    - 比如用 2018–2021 做样本内，2022–2023 做样本外。
  - 写出一份阶段性报告，服务于后续阶段 3（策略组合 + 风控）。

- **具体任务拆解**
  - 任务 4-1：时间切分与回测重跑
    - 选择一段较长时间区间（例如近 5–7 年）。
    - 按时间切成样本内 & 样本外。
    - 对所有策略分别在两个区间回测。
  - 任务 4-2：指标对比
    - 对比样本内 vs 样本外：
      - 收益、波动率、Sharpe、最大回撤、交易次数。
    - 标记出「明显过拟合」/「在不同区间风格稳定」的策略特征。
  - 任务 4-3：阶段 2 综合报告
    - 写一份 markdown 报告，建议结构：
      - 本阶段实现的策略列表 + 简要逻辑。
      - 各策略在样本内/样本外的主要指标表格。
      - 你对每个策略的主观判断：
        - 优点 / 缺点。
        - 哪些市场环境适合上场。
        - 你愿意在阶段 3 把它纳入组合吗？

---

## 第 5 块（第 9–10 周，可选机动）：回顾与重构

> 这一块是机动时间，视你前面进度和时间压力，可以拉长/缩短或与前几块交错。

- **目标**
  - 给阶段 2 留出一个「返工 + 重构」窗口，而不是一路 rush 过去。

- **建议内容**
  - 根据阶段 4 的综合报告：
    - 选择 1–2 个你最看好的策略做代码重构：
      - 清理重复逻辑，拆分函数/类。
      - 增加注释和文档。
    - 根据发现的问题，做小规模参数敏感性测试：
      - 例如均线参数从 (20, 60) 换成 (10, 50)、(30, 90) 等，看策略是否极度敏感。
  - 回顾整阶段学习：
    - 哪些知识点仍然模糊？（记进「阶段 3 待补课列表」）
    - 哪些能力有明显提升？（比如读报表、找坑、写复盘的速度和质量）

---

## 建议的文档与代码结构（可按需调整）

- 文档类（`docs/`）
  - `docs/roadmap/学习路线图-GPT加持版.md`：总路线图。
  - `docs/progress/阶段2-经典策略-2周节奏计划.md`：本文件。
  - `docs/notes/阶段2-趋势策略画像.md`：趋势相关理解与复盘。
  - `docs/notes/阶段2-均值回归与布林带.md`。
  - `docs/notes/阶段2-波动率调仓与回测原则.md`。
  - `docs/notes/阶段2-综合报告.md`：阶段性总结。

- 代码类（示例）
  - `src/stage2/data/`：数据加载与预处理脚本。
  - `src/stage2/strategies/`：各策略实现文件：
    - `ma_trend.py`：双均线趋势策略。
    - `bollinger_mean_reversion.py`：布林带均值回归。
    - `volatility_adjustment.py`：波动率调仓模块。
  - `src/stage2/backtests/`：具体回测脚本：
    - `bt_ma_trend_single_symbol.py`。
    - `bt_bollinger_single_symbol.py`。
    - `bt_trend_with_vol_adjust.py`。

---

## 使用建议

- 不强求「完全按日程走」，更重要的是：
  - 每 2 周至少能拿出一点「看得见的成果」：一个策略代码、一次回测、一个复盘 md。
  - 每一块结束时，写一段自问自答：
    - 我现在比 2 周前多了什么认知/技能？
    - 下一块我最想解决的疑惑是什么？

- 每完成一个小任务，可以在对应的 md 里打勾，并把疑惑点记下来，方便后续和 GPT 讨论、迭代。
